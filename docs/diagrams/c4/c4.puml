@startuml
!includeurl https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4.puml

LAYOUT_WITH_LEGEND()

Person(user, "User")
System_Boundary(sys, "LexBot Backend") {
  Container(apigateway, "ApiGateway", "app.interface.api", "FastAPI app; routing; authn/authz middleware")
  Container(authservice, "AuthService", "app.application.auth", "Token validation; permission checks; user context")
  Container(ingestionservice, "IngestionService", "app.application.ingestion", "Validate file; compute checksum; create IndexJob; enqueue")
  Container(indexer, "Indexer", "app.domain.indexer", "Text extraction -> chunk -> embed -> upsert to vector store")
  Container(searchservice, "SearchService", "app.domain.search", "Hybrid search (keyword + vector) and ranking")
  Container(vectorstoreadapter, "VectorStoreAdapter", "app.infrastructure.vectorstore", "Pinecone I/O; no business rules")
  Container(blobstorageadapter, "BlobStorageAdapter", "app.infrastructure.blob", "Object storage I/O (S3/MinIO); signed URLs")
}

Rel(apigateway, ingestionservice, "")
Rel(apigateway, ingestionservice, "calls")
Rel(apigateway, searchservice, "")
Rel(apigateway, indexing_jobs, "consumes")
Rel(indexer, apigateway, "")
Rel(indexer, vectorstoreadapter, "")
Rel(indexer, indexing_jobs, "consumes")
Rel(ingestionservice, indexer, "")
Rel(searchservice, apigateway, "")
Rel(searchservice, vectorstoreadapter, "")
Rel(user, apigateway, "")

@enduml
