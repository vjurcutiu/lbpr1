@startuml
!includeurl https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4.puml

LAYOUT_WITH_LEGEND()

Person(user, "User")
System_Boundary(sys, "Remote Server") {
  Container(apigateway, "ApiGateway", "app.interface.api", "FastAPI app; routing; authn/authz; rate limiting")
  Container(authservice, "AuthService", "app.application.auth", "Validate API keys/JWT; issue access tokens")
  Container(indexer, "Indexer", "app.domain.indexer", "Extract text → chunk → embed → upsert")
  Container(searchservice, "SearchService", "app.domain.search", "Hybrid search (BM25 + vector) per tenant")
  Container(vectorstoreadapter, "VectorStoreAdapter", "app.infrastructure.vectorstore", "KNN upsert/query; namespace-per-tenant")
}

Rel(apigateway, authservice, "")
Rel(apigateway, indexer, "")
Rel(apigateway, searchservice, "")
Rel(apigateway, ingestion_jobs, "consumes")
Rel(indexer, apigateway, "")
Rel(indexer, vectorstoreadapter, "")
Rel(indexer, ingestion_jobs, "consumes")
Rel(searchservice, apigateway, "")
Rel(searchservice, vectorstoreadapter, "")
Rel(user, apigateway, "")

@enduml
